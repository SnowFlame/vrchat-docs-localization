---
title: " Physbones"
---

# Physbones

 Physbones 是一组组件，可以为角色添加次要动作，例如头发、尾巴、耳朵、服装等，使角色看起来更加动态和真实。

 Physbones 是 Dynamic Bones 的替代品。虽然这两个系统有很多共同点，但 Physbones 有一些重要的区别，因此并非所有的角色都可以直接转换到VRChat的系统中。

在SDK的`VRCSDK\Examples3\Dynamics\Robot Avatar`目录下可以找到使用Avatar Dynamics的示例。

# VRC Physbone 

定义了一个由 Physbones 动画的骨骼链。这些骨骼链可以用于模拟软体和次要动作，例如头发、尾巴、耳朵等。它有许多配置选项，可以以多种方式设置。

此外， Physbones 还可以被您和其他人交互！如果您给予其他用户权限，其他人可以抓住您角色上设置的 Physbones ，并在抓住 Physbone 时按下扳机键来“定位”并保持其位置。您还可以在配置中禁用此功能，不允许定位、不允许抓取或根本不允许碰撞。

虽然 Physbones 并非专为此而设计，但它也可以作为合理的布料替代品，直到我们实现自己的布料组件为止。

![](/creators.vrchat.com/images/avatars/Physbones-ca9ee06-2022-05-04_18-23-09_Unity.png)

## 版本

您现在可以直接在组件上选择要使用的 VRC Physbone 组件的版本。创建新组件时，默认选择最新版本。现有的角色将继续使用其先前的版本，除非手动更新并重新上传。

版本1.0：

- VRC Physbone 组件的基本版本。

版本1.1：

- 弹性骨骼更新，允许骨骼弹性和长度受到运动的影响。
- 重力现在作为骨骼在静止时旋转的比例。骨骼向重力方向移动需要一个正的拉力。
- 刚度现在作为保持骨骼在其先前方向的比例。

## 变换

`Root Transform` - 组件开始的变换。如果留空，我们假设从此游戏对象开始。
`Ignore Transforms` - 不受此组件影响的被忽略的变换列表。被忽略的变换自动包括该变换的所有子级。
`Endpoint Position` - 用于在链的每个端点创建额外骨骼的向量。仅在值非零时使用。通常，您会希望沿着+Y增加此值，+Y指向骨骼的“上方”。
`Multi-Child Type` - 当存在多个骨骼链时，根骨骼的行为。有三种模式：

 如果设置为 **Ignore** ，根骨骼将不移动，并忽略物理效果。对于头发等物体非常有用，因为您可以在根骨骼上使用一个 Physbone 组件来影响所有头发骨骼！

 如果设置为 **First** ，根骨骼将与层次结构中的第一个骨骼链形成一个连续的链。其他所有链仍然有效，但它们将从每个相应链的第一个骨骼开始，而不是从根骨骼开始。

 如果设置为 **Average** ，根骨骼的运动将是所有其他链的平均值。这意味着每个链的基部都可以移动。

: danger
如果您使用单个根骨骼或单个根骨骼及其多个子级（但没有孙级），则 **必须** 定义一个端点位置！

例如，如果您将 Physbone 组件放在下面的任何一个 `根骨骼` 上，为了使 Physbones 正常工作，您**必须**定义一个 **Endpoint Position** 。这与 Dynamic Bones 不同！

单个根骨骼

- `根骨骼`

多个子骨骼，单个根骨骼

- `根骨骼`
  - `子骨骼1`
  - `子骨骼2`
  - `子骨骼3`
  - `子骨骼4`

您还可以通过在每个`ChildBone`之后添加“末端骨骼”来解决此问题，但这涉及对骨架进行编辑。
:::

## Forces (受力)

**Integration Type** 定义了用于模拟受此组件影响的任何变换运动的数学类型。根据您选择的类型，力量部分的选项将发生变化。您可以在以下两种类型之间选择：

- `Simplified` 是一种更稳定的方法，感觉有点慢，对外部冲击和力量反应不太敏感，但更容易配置。
- `Advanced` 不太稳定，但允许更复杂的配置，并且对外部冲击和力量反应更敏感。
  在默认设置下，这两种模式的行为非常相似，但调整设置并进行测试将很快揭示它们之间的差异。

::: info
下面的大多数（如果不是全部）选项都可以通过在滑块旁边按下 C 按钮来使用曲线。曲线可以让您调整骨骼链的长度上的值，并允许在骨骼链内进行非常复杂的设置！

事实上，大多数 Physbones 设置都可以使用曲线！学会使用它们，您的 Physbone s将看起来很棒！
:::

![Physbones-054e326-2022-04-19_11-32-12_Unity.png](/creators.vrchat.com/images/avatars/Physbones-054e326-2022-04-19_11-32-12_Unity.png)

`Pull` - 用于将骨骼恢复到其静止位置的力量大小。
`Spring` - 当骨骼试图达到其静止位置时，骨骼会摆动的程度。仅在简化的Integration Type中可用。
`Momentum` - 当骨骼试图达到其静止位置时，骨骼会摆动的程度。仅在高级的Integration Type中可用。尽管描述相同，但效果与Spring略有不同。
`Stiffness` - 骨骼试图保持在其静止位置的程度。仅在高级的Integration Type中可用。
`Gravity` - 应用于骨骼的重力大小。正值向下拉动骨骼，负值向上拉动骨骼。
`Gravity Falloff` - 仅在Gravity非零时可用。它控制在静止位置时去除多少重力。值为1.0表示在静止位置时完全不受重力影响。这样，当骨骼从初始位置旋转时，可以具有重力的效果，而不会影响骨骼的静止状态。

使用 Gravity Falloff 参数的一种方法是，如果您的头发已经被建模为在正常站立时所需的姿势，您可以使用 1.0 的重力衰减。这样，当您只是站在那里时，重力不会影响您，您的头发将保持在其建模位置。如果您的头发被建模为 45 度向外伸展，并且您希望它受到足够的重力影响以形成漂亮的曲线（但不完全向外伸展或完全向下伸展），滑块允许您进行调整，使用 0.5-0.8 之间的值，只在静止姿势时施加一部分重力。

`Immobile Type`更改`Immobile`的行为。

 如果设置为**All Motion**，`Immobile` 会减少从根变换的父级计算出的任何运动。这是新的 Physbone s和转换的 Dynamic Bones 的**默认模式**。在此模式下，场景空间或播放空间中的所有 Physbone 移动都将受到 `Immobile` 因子的抑制。

如果设置为 **World (Experimental)** ， `Immobile` 仅从场景根变换的参考位置消除位置运动。动画或IK引起的运动仍会正常影响骨骼。_此模式可能会在将来更改！_

这意味着在播放空间中移动仍会正常影响 Physbones 的运动，但是在播放空间中移动（按下摇杆移动）的运动将受到 `Immobile` 因子的抑制。

## Limits (限制)

设置 Limits (限制)可以限制 Physbone 链的移动量。当您不希望头发进入头部时，这非常有用，并且比碰撞器要**高效得多**！

此外，在配置限制选项时，当您选择 Physbone 链时，场景视图中将显示这些限制的可视化。在微调限制时，这些可视化非常有帮助！

`Limit Type` 有几种模式。所有模式都允许根据 `Rotation` 在 `Pitch` 、`Yaw` 和 `Roll` 方面进行 `Rotation` 的调整，或者分别沿X、Y和Z轴进行调整。

### None

`None` 表示此骨骼链上没有启用限制。没有配置选项。

### Angle

`Angle` 表示骨骼链将限制在某个 `Max Angle` 上，以 `Rotation` 定义的轴为中心。在场景视图中，这被可视化为一个圆锥体。

### Hinge

 `Hinge` 表示骨骼链将限制在由 `Rotation` 定义的平面上的某个 `Max Angle` 上。在场景视图中，这被可视化为一个圆片的切片，类似于比萨饼或馅饼。

### Polar

`Polar` 有点复杂。如果您将 `Hinge` 沿 `Yaw` 扫过一定角度，您将得到 `Polar` 坐标中的一个球段。您可以配置 `Max Pitch` 和 `Max Yaw` 来调整段的大小，并使用 `Rotation` 来定义该段在球体上的位置。`Polar` 的可视化特别有帮助。

不要过度使用Polar限制，因为它们会产生一定的性能成本。使用大量（手势：超过64个）可能会导致一些问题。如果您的 `Max Pitch` 和 `Max Yaw` 值相似或相同，则 `Angle` 限制就足够了，并且在性能方面成本较低。

## 碰撞

`Radius` - 骨骼周围的碰撞半径（以米为单位）。用于碰撞和抓取。
`Allow Collision` - 允许与此组件上指定的碰撞器以外的碰撞器发生碰撞。目前，唯一的其他碰撞器是每个玩家的手和手指，由其角色定义。
`Colliders` - 与这些骨骼发生碰撞的碰撞器列表。

## 伸缩和压缩

`Stretch Motion` - 运动对骨骼的伸缩/压缩的影响程度。值为零意味着骨骼只会因抓取或碰撞而伸缩/压缩。
`Max Stretch` - 骨骼可以伸展的最大量。该值是原始骨骼长度的倍数。[注意：最大边界](#maximum-bounds)
`Max Squish` - 骨骼可以收缩的最大量。该值是原始骨骼长度的倍数。

## 抓取和定位

`Allow Grabbing` - 允许玩家抓取骨骼。
`Allow Posing` - 允许玩家在抓取后定位骨骼。
`Grab Movement` - 控制抓取的骨骼移动方式。值为零时，骨骼使用拉力和弹簧来达到抓取位置。值为一时，骨骼立即移动到抓取位置。
`Snap To Hand` - 当骨骼被抓取时，它将与抓取它的骨骼对齐。

## 选项

- `Parameter` - 用于为角色控制器提供多个参数的前缀。在下面的项目中，将参数设置为`Tail`将使用`Tail`替换`{parameter}`。
- `{parameter}_IsGrabbed` - [Bool] 骨骼当前是否被抓取。
- `{parameter}_IsPosed` - [Bool] 骨骼是否被定位。
- `{parameter}_Angle` - [Float] 0.0-1.0范围。从其原始静止位置到末端骨骼的180度角度的归一化值。换句话说，如果您完全扭曲骨骼与其起始方向相反，此参数的值将为1.0。
- `{parameter}_Stretch` - [Float] 0.0-1.0范围。骨骼离其最大伸展长度有多近。
- `Is Animated` - 允许对骨骼变换进行动画处理。每帧骨骼静止位置将根据动画进行更新。必须启用此选项，以使 Physbone 链中的任何骨骼（包括根骨骼！）遵守应用于它的动画。
- `Reset When Disabled` - 当此组件被禁用时，骨骼将自动重置到其默认位置。

## 重要说明、使用技巧等

**不要在同一个游戏对象上同时放置约束和 Physbone 组件**，因为这会导致执行顺序问题。

将约束放在父游戏对象上。您仍然可以将约束的目标设置为原始游戏对象。

::: warning Quest限制

** Physbones在 Meta Quest 上有严格的限制。**这是为了防止 Meta Quest 设备的性能降低，这些设备的 CPU 资源通常已经很低。

您可以将这些限制视为Quest的非常差的限制，详细信息请参阅[最低显示性能等级](/creators.vrchat.com/avatars/avatar-performance-ranking-system#quest-limits)文档。

:::

### 每个组件的限制

**单个 Physbone 组件不能同时影响超过256个变换。**这包括根骨骼以及所有子级。_这也会影响 Dynamic Bone 的转换！_

但是，您应该尽量避免在第一次动画中有太多的变换。尝试将链中的骨骼向上合并到其直接父级。社区创建的工具（如Cat's Blender插件）可以为您完成此操作。

### 动画属性

 Physbone 的属性，如 Spring、Pull、Stiffness 等，在初始化时设置，**不能进行动画处理**。

但是，如果您对 Physbone 组件的属性进行动画处理，然后将组件动画处理关闭再打开，您可能会得到所需的行为。请注意，这不是对这些属性进行动画处理的支持方法，并且在将来的更改中将不再支持。（换句话说，它可能会出错。如果出错，我们不会尝试修复它。）

### 人体骨骼

**不要将人体骨骼设置为 Physbone 的根骨骼。**换句话说，不要将 Hip、Spine、Chest、Upper Chest、Neck、Head 或任何肢体骨骼设置为根骨骼。这将导致严重问题。

相反，复制要用作根骨骼的骨骼，并将要动画的所有子骨骼重新连接到新的复制根骨骼。这应该在 Blender 中完成。社区创建的工具（如 Cat's Blender 插件）可以为您完成此操作。

###  Physbone 旋转

与 Dynamic Bones 不同，** Physbone 链的根骨骼允许旋转**。但是它不能平移。这可能会对某些设置产生一些影响-请自行尝试以了解其行为。

###  Physbone  AV3参数

在影响参数时，**无需使用由 `VRCExpressionParameters` 对象定义的同步参数**。这些参数已在本地和远程机器上更新，因为两者都将运行 Physbone s。

###  Physbone 不可移动行为

 Dynamic Bones 将其 `Inert` 值基于组件的位置，而不是根变换。这可能是 Dynamic Bones 的一个错误。因此， Physbones 将其 `Immobile` 值基于根变换。这可能会影响某些情况下的行为。

### 最佳组件使用

由于 Physbones 的多线程特性，将所有骨骼放入单个链中并不总是最高效的。多个组件使我们能够在线程之间分解工作。但是，您仍然应该努力减少组件的数量...但是与 Dynamic Bones 相比，拥有几个组件并不会像以前那样糟糕。

如果您真的需要一个数字，当您的单个组件影响超过128个变换时，应考虑将链集拆分。如果您有一个包含 256 个骨骼的裙子，并且在根处分割，将其分割为两个或三个组件将起作用。

但是，如果您只处理大约 32 个骨骼的情况...不要担心。正如您可能已经注意到的，这些都不是严格的规则！我们可能会在某些情况下引入一些软警告，当某些东西看起来应该以不同的方式设置时。

### 最大边界

每个VRC Physbone 组件都有一个边界框，随着骨骼的移动而增长和收缩。这些边界框有助于检测触摸和抓取 Physbones 的玩家的碰撞。为了效率起见，边界框被强制为最大为 10×10×10 米。 Physbones 可以超出此范围并继续正常工作。但是，根据其位置，玩家可能无法触摸或抓取这些骨骼。

边界框仅考虑具有碰撞和半径大于零的骨骼。在需要提供非常长的伸展的情况下，只要在伸展点之后存在具有碰撞的骨骼，您就可以避免达到此最大边界限制。

# VRC Physbone Collider

定义了一个会影响正确配置的 Physbones 的碰撞器。

![](/creators.vrchat.com/images/avatars/Physbones-ac38f46-2022-05-04_18-35-11_Unity.png)

- `Root Transform` - 此碰撞器所放置的变换。如果为空，我们使用此游戏对象的变换。
- `Shape Type` - 此碰撞器使用的碰撞形状类型。您可以选择球体、胶囊体或平面碰撞器。
- `Radius` - 从其原点延伸的碰撞器的大小。
- `Height` - 沿Y轴的胶囊体高度。
- `Position` - 相对于根变换的位置偏移量。
- `Rotation` - 相对于根变换的旋转偏移量。
- `Inside Bounds` - 启用时，此碰撞器将包含其边界内的骨骼，而不是将其排除在外。
- `Bones As Sphere` - 启用时，此碰撞器将将 Physbone 碰撞半径视为以骨骼位置为中心的球体，而不是沿骨骼长度的胶囊体。

## 标准碰撞器

在Avatar Descriptor中定义了一组“标准碰撞器”，位于一个名为 “Colliders” 的新部分中。此部分允许您定义一些存在于每个角色上的标准碰撞器。如果您不进行任何更改，这些碰撞器将自动设置，但也可以进行微调以完全适应您的角色。这些碰撞器不会影响性能评级。

- 头部
- 躯干
- 手 L/R
- 脚 L/R
- 手指 L/R
  - 食指
  - 中指
  - 无名指
  - 小指

这些碰撞器主要作为 [Contact](/creators.vrchat.com/avatars/avatar-dynamics/contacts) 发送器，其他人可以用其角色检测到。但是，手指和手部碰撞器也用于创建全局的 [Physbone](Physbones) 碰撞器，可以用于影响其他人的 Physbones。

## 自动Dynamic Bone转换

默认情况下，客户端将自动将 Dynamic Bones 转换为 Physbones。这样做是为了提高整体性能，并且对于角色之间的交互也是必要的。如果需要，您可以在主菜单的性能选项部分切换此选项，但您将失去性能提升和其他人与您交互的能力。

默认情况下，Dynamic Bone 转换使用 Advanced 模式，因为我们能够更精确地将 DB 行为与 Advanced 集成方法匹配。此外，DB转换使用 Ignore 作为 Multi-Child 类型。这可能会导致某些边缘情况的 DB 设置出现问题，但在转换过程中使用 First 或 Average 会导致几乎所有情况下的不良行为。

关闭转换意味着您将无法与由 Dynamic Bones 驱动的角色骨骼进行任何交互。但是，原生使用 Physbones 和 Contacts 的角色将不受影响。

**重要说明： Dynamic Bones 和 Physbones 并不相同。**程序中的转换过程并不完美，我们打算随着时间的推移对其进行更多更新。但请记住：转换过程永远不会完美！自动转换的目标是使大多数设置工作得相当好，而不是完全复制行为。_预计所有用户都将逐渐过渡到使用 Physbones ，以确保其角色的准确渲染和未来兼容性。_

## 手动Dynamic Bone转换

您可以选择使用 SDK 将角色从 Dynamic Bones 转换为 Physbones。

此过程将从角色中删除以前的 Dynamic Bone 组件，并且不容易恢复。因此，在尝试此转换之前，请备份您的角色。

您可以通过查看构建控制面板或在 Unity 菜单中访问 `VRChat SDK/Utilities/Convert DynamicBones to  Physbones` 来访问此工具。在此之前，必须先选择角色。

## 未迁移的Dynamic Bone组件

 Dynamic Bones 中的某些功能和行为在 Physbones 中不存在，因此不会迁移。

`Force` - Dynamic Bone中X或Z方向的 `Gravity` 和 `Force` 值在 Physbones 中被忽略，因为在 Physbones 中没有相应的值。

## 最终Dynamic Bone弃用

 Dynamic Bones 最终将从 VRChat 中完全删除。到那时，仍在使用 Dynamic Bones 的所有旧角色将使用自动转换。

稍后，我们将提供一个弃用日期，以便允许角色作者有足够的时间进行转换。